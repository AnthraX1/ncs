<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
		<META HTTP-EQUIV="Expires" CONTENT="0">
		<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache,must-revalidate">
		<META HTTP-EQUIV="Pragma"  		CONTENT="no-cache">
		<META HTTP-EQUIV="Jon Eyrick"  CONTENT="no-cache">
<title>百度地图</title>
<style>
.marker div { position:absolute;  min-width:51px;}
.marker .marker_hover{z-index:2}
.marker_0 { height:34px; white-space:nowrap;width:50px;}
.marker_0 .marker_word, .marker_0 .marker_r { background:url()  0px 0 no-repeat; }

.marker_0 .marker_word { height:34px; line-height:23px; padding:0 1px; cursor:pointer;color: white;text-align: center;font-family:simsun }
.marker_0 .marker_word { padding-top:1px;*padding-top:0; }
/*
.marker_0 .marker_r { width:3px; height:24px; position:absolute; right:-2px; top:1px; z-index:110px; }
.marker_0 .marker_r { background-position: 0 -24px; }
.marker_0 .marker_b { background:url(/images/commit.png) no-repeat; bottom:7px;height:11px;left:13px;overflow:hidden;position:absolute;width:10px;}
.marker_0 .marker_b { background-position: 0 0; }*/


.marker {    position: absolute;   display: none;  min-width:51px; height: 34px;padding: 0 1px; color: white;text-align: center; font-size: 12px;cursor: pointer; line-height: 23px; 
				background: url(/images/normal.png) 1px 0 no-repeat;}
.marker_hover {z-index: 10; background-image: url(/images/open_hover.png);}
</style>
<!-- api -->
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.2"></script>
<!-- 聚合marker -->
<script type="text/javascript" src="/js/baidu/mark_jiqun/TextIconOverlay_min.js"></script>
<script type="text/javascript" src="/js/baidu/mark_jiqun/MarkerClusterer_min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js"></script>
</head>
<body>

	
<div style="width:935px;height:430px;border:1px solid gray" id="container"></div>
</body>
</html>
<script type="text/javascript">
	
	//width:48px;    background: none;    background-color:transparnt;
  //  filter:progid:DXImageTransform.Microsoft.AlphaImageLoader (src='http://pages.anjukestatic.com/img/map/normal.png');
var mapOptions = { zoomLevelMin : 9 , zoomLevelMax : 18 };	
var map = new BMap.Map("container",mapOptions);
var MAX=80;             //marker number
var markers = [];
var pt = null;
var i = 0;
//map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);

//map.centerAndZoom(new BMap.Point(114.29969787597656,29.853746350935715), 11);
//map.addEventListener("click", function(){
//  alert("您点击了地图。");
//});
//var local = new BMap.LocalSearch(map, {  
// renderOptions:{map: map}  
//});  
//local.search("咸宁市");


//map.centerAndZoom(new BMap.Point(114.29969787597656,29.853746350935715), 10);  
		
		map.centerAndZoom(new BMap.Point(114.1897705078125,29.63522956294847), 10);  
		var opts = {type: BMAP_NAVIGATION_CONTROL_LARGE}  
		map.addControl(new BMap.NavigationControl(opts));  
		map.addControl(new BMap.ScaleControl()); 
		map.enableScrollWheelZoom();
//		var local = new BMap.LocalSearch("咸宁市", {  
//		 renderOptions: {  
//		   map: map,  
//		   autoViewport: true,  
//		   selectFirstResult: false  
//		 },  
//		  pageCapacity: 8  
//		});  
//		local.search("酒店");  


//		var xx=0;
//		var yy=0;
//		var marker_s=new Array();
//		var lat=new Array();
//		var lon=new Array();
//						//add the first marker
//						//测试60个marker加载速度
//		for(var i=0;i<MAX_marker;i++){
//							//xx+=0.005;
//							//yy+=0.0025;
//				xx+=Math.random()*0.01;
//				yy+=Math.random()*0.002;
////			  lat[i]=117.90183+xx;
////				lon[i]=24.41613+yy;
//				//var lat=117.90183+xx;
//				//var lon=24.41613+yy;
//				var lat=114.90183+xx;
//				var lon=29.41613+yy;
//				//alert("i ="+i+"  lat="+lat[i]+" lon="+lon[i]+"  random="+Math.random());
//				
//				//alert("i ="+i+"  lat="+lat+" lon="+lon+"  random="+Math.random());
//				//marker_s[i]= PointFeature.createPointFeature(new Location(lat[i],lon[i]));
//							
//							
//				//var marker:PointFeature = PointFeature.createPointFeature(new Location(118.10183,24.51613));
//							
////				markers.addFeature(CustomMarker.createUrlBasedMarker("http://earth.google.com/intl/en_uk/outreach/images/add_placemark.png",
////																new Location(lat[i],lon[i])));
//														
//				//markers.addFeature(marker_s[i]);
//				
//				
//				var point4 = new BMap.Point(lat, lon);  
//
//				var label4 = new BMap.Label('',{ point:point4 });
//				label4.setStyle({position:'absolute',border:'none',background:'none',zIndex:'1'});
//				var ct = '<div class="marker_0"><div class="marker_word">文本标注';
//				ct += '<em class="marker_r"></em></div><em class="marker_b"></em></div>';
//				label4.setContent(ct);
//				label4.setOffset(new BMap.Size(0,-35));
//				map.addOverlay(label4);
//
//				
//				
//				//var marker = new BMap.Marker(new BMap.Point(lat, lon));  
//				//map.addOverlay(marker); 
//			}
		
   // var marker = new BMap.Marker(point);  
   // map.addOverlay(marker); 
   
   
   
   //最简单的用法，生成一个marker数组，然后调用markerClusterer类即可。
   var markerClusterer = new BMapLib.MarkerClusterer(map, {markers:markers});

   //添加和删除Markers
   var newMarkers = getNewMarkers(MAX);
   var newMarkers2 = newMarkers;
 
 	  for (i = 0; i < MAX; i++) {
//           map.addOverlay(newMarkers2[i]);
           

					var result = BMapLib.GeoUtils.isPointInRect(newMarkers2[i].point, map.getBounds());     //显示可视区域内的标注
 	   	    if(result == true) 
 	   	    	map.addOverlay(newMarkers2[i]);  
 	   	    else 
 	   	    	map.removeOverlay(newMarkers2[i]); 
 	   	    window.setTimeout(function(){
//            canvas.setStyle({"height":canvasHeight+"px"});
//            container.setStyle({"width":containerWidth});
        }, 800);  //i++*30

    }
 map.addEventListener("moveend", getNewMarkers);
 //显示可视区域内的标注
// function addMymarkers(){   
// 	 document.getElementById("info").innerHTML = '';  
// 	 for(i=0;i<markers.length;i++){    
// 	   	    var result = BMapLib.GeoUtils.isPointInRect(markers[i].point, map.getBounds());     
// 	   	    if(result == true) 
// 	   	    	map.addOverlay(markers[i]);  
// 	   	    else 
// 	   	    	map.removeOverlay(markers[i]);   
// 	   	    document.getElementById("info").innerHTML += '<img src="' + markers[i].getIcon().imageUrl +'" />';            
// 	  }
// }
 
 
 
//   var btnAddMarkers = document.getElementById('btnAddMarkers');
//   btnAddMarkers.onclick = function (event) {
//       if(!newMarkers.length){
//                //如果之前的markers被清空了，则重新生成
//                newMarkers = getNewMarkers(MAX);
//                newMarkers2 = newMarkers;
//       };
//       markerClusterer.addMarkers(newMarkers);
//       for (i = 0; i < MAX; i++) {
//           map.addOverlay(newMarkers2[i]);
//       }
//    };
// 
//    var btnRemoveMarkers = document.getElementById('btnRemoveMarkers');
//    btnRemoveMarkers.onclick = function (event) {         
//            markerClusterer.removeMarkers(newMarkers);
//            for (i = 0; i < MAX; i++) {
//                map.removeOverlay(newMarkers2[i]);
//            }
//    };

   
   
   /**
   * 得到一个随机的marker数组。
   * @param  {Number} 数组的长度
   * @return {Array} 随机marker数组
   */
   
   function getNewMarkers(MAX){
   			var xx=0.0;
   			var yy=0.0;
        var newMarkers = [];
        var label4=new Array();
        var ct;
        for (i = 0; i < MAX; i++) {
                //pt = new BMap.Point(Math.random() * 40 + 85, Math.random() * 30 + 21);
                xx+=Math.random()*0.1;
                yy+=Math.random()*0.1;
                //alert("i ="+i+"  xx="+xx+" yy="+yy+"  random="+Math.random());
                if(i%2==0){
                	if(i>30)
                	pt = new BMap.Point(113.10183+xx, 29.01613+yy);
                	else
                	pt = new BMap.Point(113.30183+xx, 29.01613+yy);
                }else{
                	if(i>30)
                	pt = new BMap.Point(113.60183+xx, 29.01613+yy);
                	else
                	pt = new BMap.Point(113.90183+xx, 29.01613+yy);
              	}
                label4[i] = new BMap.Label('',{ point:pt });
								label4[i] .setStyle({position:'absolute',border:'none',background:'none',zIndex:'1'});
								if(i%2==0){
									var ct = '<div class="marker_0"><div class="marker_word">宾馆';
									ct += '<em class="marker_r"></em></div><em ></em></div>';
								}else{
									var ct = '<div class="marker_0"><div class="marker_word">酒店';
									ct += '<em class="marker_r"></em></div><em ></em></div>';
								}								
								label4[i] .setContent(ct);
								//label4[i] .setOffset(new BMap.Size(0,-15));	
//                newMarkers.push(label4);       
                
                //newMarkers.push(new BMap.Label('酒店',{ point:pt }));    
                var icon = new BMap.Icon("/images/normal.png", new BMap.Size(50,50),new BMap.Size(0,-15)); 
                var marker =new BMap.Marker(pt)
                marker.setIcon(icon);
                marker.setLabel(label4[i] );
                newMarkers.push(marker);               
                //newMarkers.push(new BMap.Marker(pt));               
        }
        return newMarkers;   
  }

   
   
</script>
